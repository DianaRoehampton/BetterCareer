<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Firebase Auth</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" 
    integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
  </head>
  <body>

    <form id="form" class="w-25 m-4">
      
        <h2 class="mb-3">Sign in</h2>

      <div class="form-floating mb-3">
        <input type="email" class="form-control" id="mail" placeholder="name@example.com">
        <label for="floatingInput">Email address</label>
      </div>
      <div class="form-floating mb-3">
        <input type="password" class="form-control" id="pwd" placeholder="Password">
        <label for="floatingPassword">Password</label>
      </div>

      <button type="submit" class="btn btn-primary me-2" style="float: left;">Sign In</button>
      <a href="register.html"><button type="button" style="float: left;" class="btn btn-primary">Register</button></a>
      
    </form>
    
    
    
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" 
    integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" 
    crossorigin="anonymous"></script>

    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-analytics.js";

        import { getDatabase, get, ref, child } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js";
        import { getAuth, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";

      
        // Your web app's Firebase configuration
        const firebaseConfig = {
          apiKey: "AIzaSyCp-FYM-77QwCtFEYA5yQCUpHMSTl6oJWc",
          authDomain: "bettercareer-27033.firebaseapp.com",
          databaseURL: "https://bettercareer-27033-default-rtdb.firebaseio.com",
          projectId: "bettercareer-27033",
          storageBucket: "bettercareer-27033.appspot.com",
          messagingSenderId: "898798821793",
          appId: "1:898798821793:web:2d6b543a871403d3376be0",
          measurementId: "G-3YBVGWX48B"
        };
      
        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const analytics = getAnalytics(app);

        const db = getDatabase();
        const auth = getAuth(app);
        const dbref = ref(db);

        let Email = document.getElementById('mail');
        let Password = document.getElementById('pwd');
        let Form = document.getElementById('form');

        let SignInUser = evt =>{
            evt.preventDefault();

            signInWithEmailAndPassword(auth, Email.value, Password.value)
            .then((credentials)=>{
                get(child(dbref, '/UserAuthList' + credentials.user.uid)).then((snaphot)=>{
                    if(snapshot.exists){
                        sessionStorage.setItem("user-info", JSON.stringify({
                            name: snapshot.val().name
                        }))
                        sessionStorage.setItem("user-creds", JSON.stringify(credentials.user));
                        window.location.href ='home.html'
                    }
                })
            })
            .catch((error)=>{
                alert(error.message);
                console.log(error.code);
                console.log(error.message);
            })
        }

        Form.addEventListener('submit', SignInUser);


      </script>
  </body>
</html>